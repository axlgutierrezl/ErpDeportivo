import{m as ae}from"./VSelect.1e68f7fa.js";import{E as ne,d as V,u as ue,D as J,aC as oe,W as ie,S as se,h as M,G as Q,p as T,a4 as W,b as f,F as X,a0 as N,k as re}from"./app.50683a97.js";import{m as ce,u as ve,f as fe,q as de,w as me}from"./index.4549214f.js";import{s as he,A as j,i as be,e as ye,c as H}from"./VNavigationDrawer.8088819a.js";import{V as ge}from"./VCheckboxBtn.fafb4134.js";import{V as ke}from"./VChip.0d8836c3.js";import{V as xe}from"./VTextField.65545f13.js";const Ce=(e,o,t)=>e==null||o==null?-1:e.toString().toLocaleLowerCase().indexOf(o.toString().toLocaleLowerCase()),Fe=ne({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function Ve(e,o,t){var h,s;const _=[],i=(h=t==null?void 0:t.default)!=null?h:Ce,I=t!=null&&t.filterKeys?J(t.filterKeys):!1,b=Object.keys((s=t==null?void 0:t.customKeyFilter)!=null?s:{}).length;if(!(e!=null&&e.length))return _;e:for(let a=0;a<e.length;a++){const k=e[a],p={},S={};let y=-1;if(o&&!(t!=null&&t.noFilter)){if(typeof k=="object"){const r=I||Object.keys(k);for(const g of r){var m;const c=oe(k,g,k),F=t==null||(m=t.customKeyFilter)==null?void 0:m[g];if(y=F?F(c,o,k):i(c,o,k),y!==-1&&y!==!1)F?p[g]=y:S[g]=y;else if((t==null?void 0:t.filterMode)==="every")continue e}}else y=i(k,o,k),y!==-1&&y!==!1&&(S.title=y);const A=Object.keys(S).length,K=Object.keys(p).length;if(!A&&!K||(t==null?void 0:t.filterMode)==="union"&&K!==b&&!A||(t==null?void 0:t.filterMode)==="intersection"&&(K!==b||!A))continue}_.push({index:a,matches:{...S,...p}})}return _}function _e(e,o,t){const _=V(()=>typeof(t==null?void 0:t.value)!="string"&&typeof(t==null?void 0:t.value)!="number"?"":String(t.value));return{filteredItems:V(()=>{const I=ue(o);return Ve(I,_.value,{customKeyFilter:e.customKeyFilter,default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}).map(m=>{let{index:h,matches:s}=m;return{item:I[h],matches:s}})})}}function pe(e,o,t){if(Array.isArray(o))throw new Error("Multiple matches is not implemented");return typeof o=="number"&&~o?f(X,null,[f("span",{class:"v-combobox__unmask"},[e.substr(0,o)]),f("span",{class:"v-combobox__mask"},[e.substr(o,t)]),f("span",{class:"v-combobox__unmask"},[e.substr(o+t)])]):e}const Le=ie()({name:"VCombobox",props:{delimiters:Array,...Fe({filterKeys:["title"]}),...ae({hideNoData:!0,returnObject:!0}),...ce({transition:!1})},emits:{"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,o){var z;var t;let{emit:_,slots:i}=o;const{t:I}=se(),b=M(),m=M(!1),h=M(!0),s=Q(e,"menu"),a=M(-1),k=V(()=>{var l;return(l=b.value)==null?void 0:l.color}),{items:p,transformIn:S,transformOut:y}=he(e),{textColorClasses:A,textColorStyles:K}=ve(k),r=Q(e,"modelValue",[],l=>S(J(l||[])),l=>{var u;const n=y(l);return e.multiple?n:(u=n[0])!=null?u:null}),g=M(e.multiple?"":(z=(t=r.value[0])==null?void 0:t.title)!=null?z:""),c=V({get:()=>g.value,set:l=>{var n;if(g.value=l,e.multiple||(r.value=[j(e,l)]),l&&e.multiple&&(n=e.delimiters)!=null&&n.length){const u=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));u.length>1&&(u.forEach(x=>{x=x.trim(),x&&w(j(e,x))}),g.value="")}l||(a.value=-1),m.value&&(s.value=!0),h.value=!l}});T(g,l=>{_("update:search",l)}),T(r,l=>{var u;if(!e.multiple){var n;g.value=(u=(n=l[0])==null?void 0:n.title)!=null?u:""}});const{filteredItems:F}=_e(e,p,V(()=>h.value?void 0:c.value)),D=V(()=>r.value.map(l=>p.value.find(n=>n.value===l.value)||l)),R=V(()=>D.value.map(l=>l.props.value)),B=V(()=>D.value[a.value]),$=M();function Y(l){r.value=[],e.openOnClear&&(s.value=!0)}function U(){e.hideNoData&&!p.value.length||e.readonly||(s.value=!0)}function Z(l){if(e.readonly)return;const n=b.value.selectionStart,u=R.value.length;if(a.value>-1&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(s.value=!0),["Escape"].includes(l.key)&&(s.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(h.value=!0),l.key==="ArrowDown"){var x;(x=$.value)==null||x.focus("next")}else if(l.key==="ArrowUp"){var v;(v=$.value)==null||v.focus("prev")}if(!!e.multiple){if(["Backspace","Delete"].includes(l.key)){if(a.value<0){l.key==="Backspace"&&!c.value&&(a.value=u-1);return}w(B.value),W(()=>!B.value&&(a.value=u-2))}if(l.key==="ArrowLeft"){if(a.value<0&&n>0)return;const d=a.value>-1?a.value-1:u-1;D.value[d]?a.value=d:(a.value=-1,b.value.setSelectionRange(c.value.length,c.value.length))}if(l.key==="ArrowRight"){if(a.value<0)return;const d=a.value+1;D.value[d]?a.value=d:(a.value=-1,b.value.setSelectionRange(0,0))}l.key==="Enter"&&(w(j(e,c.value)),c.value="")}}function q(){m.value&&(h.value=!0)}function w(l){if(e.multiple){const n=R.value.findIndex(u=>u===l.value);if(n===-1)r.value=[...r.value,l];else{const u=[...r.value];u.splice(n,1),r.value=u}c.value=""}else r.value=[l],g.value=l.title,W(()=>{s.value=!1,h.value=!0})}function ee(l){m.value=!0}function le(l){if(l.relatedTarget==null){var n;(n=b.value)==null||n.focus()}}return T(F,l=>{!l.length&&e.hideNoData&&(s.value=!1)}),T(m,l=>{if(l)a.value=-1;else{if(s.value=!1,!e.multiple||!c.value)return;r.value=[...r.value,j(e,c.value)],c.value=""}}),fe(()=>{const l=!!(e.chips||i.chip);return f(xe,{ref:b,modelValue:c.value,"onUpdate:modelValue":[n=>c.value=n,n=>{n==null&&(r.value=[])}],validationValue:r.externalValue,dirty:r.value.length>0,class:["v-combobox",{"v-combobox--active-menu":s.value,"v-combobox--chips":!!e.chips,"v-combobox--selecting-index":a.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0}],appendInnerIcon:e.items.length?e.menuIcon:void 0,readonly:e.readonly,"onClick:clear":Y,"onClick:control":U,"onClick:input":U,onFocus:()=>m.value=!0,onBlur:()=>m.value=!1,onKeydown:Z},{...i,default:()=>{var n,u,x;return f(X,null,[f(be,N({modelValue:s.value,"onUpdate:modelValue":v=>s.value=v,activator:"parent",contentClass:"v-combobox__content",eager:e.eager,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:q},e.menuProps),{default:()=>[f(ye,{ref:$,selected:R.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:v=>v.preventDefault(),onFocusin:ee,onFocusout:le},{default:()=>{var v;return[!F.value.length&&!e.hideNoData&&((v=(n=i["no-data"])==null?void 0:n.call(i))!=null?v:f(H,{title:I(e.noDataText)},null)),(u=i["prepend-item"])==null?void 0:u.call(i),F.value.map((d,O)=>{var G;var L;let{item:C,matches:te}=d;return(G=(L=i.item)==null?void 0:L.call(i,{item:C,index:O,props:N(C.props,{onClick:()=>w(C)})}))!=null?G:f(H,N({key:O},C.props,{onClick:()=>w(C)}),{prepend:P=>{let{isSelected:E}=P;return e.multiple&&!e.hideSelected?f(ge,{modelValue:E,ripple:!1},null):void 0},title:()=>{var E;var P;return h.value?C.title:pe(C.title,te.title,(E=(P=c.value)==null?void 0:P.length)!=null?E:0)}})}),(x=i["append-item"])==null?void 0:x.call(i)]}})]}),D.value.map((v,d)=>{function O(C){C.stopPropagation(),C.preventDefault(),w(v)}const L={"onClick:close":O,modelValue:!0,"onUpdate:modelValue":void 0};return f("div",{key:v.value,class:["v-combobox__selection",d===a.value&&["v-combobox__selection--selected",A.value]],style:d===a.value?K.value:{}},[l?f(me,{defaults:{VChip:{closable:e.closableChips,size:"small",text:v.title}}},{default:()=>[i.chip?i.chip({item:v,index:d,props:L}):f(ke,L,null)]}):i.selection?i.selection({item:v,index:d}):f("span",{class:"v-combobox__selection-text"},[v.title,e.multiple&&d<D.value.length-1&&f("span",{class:"v-combobox__selection-comma"},[re(",")])])])})])}})}),de({isFocused:m,isPristine:h,menu:s,search:c,selectionIndex:a,filteredItems:F,select:w},b)}});export{Le as V};
